# WireViz: Stepper port + Enable/E-stop (one port, two drivers)
# See stage_wiring.md for design rationale

metadata:
  title: ILEMT Stage - Stepper Port & Enable/E-Stop

connectors:
  MC508_STEP:
    type: MDR-20
    notes: "MC508 Stepper Port (ATYPE 43, P849)"
    pins: [1, 3, 11, 13, 7, 8, 15]
    pinlabels: ["Pulse(N)+", "Dir(N)+",
                "Pulse(N+8)+", "Dir(N+8)+",
                WDOG+, WDOG-, 0V]

  DRV_A:
    type: Screw Terminal
    notes: "KL-4030 Driver A (Axis N)"
    pins: [1, 2, 3, 4, 5, 6]
    pinlabels: ["PUL+", "PUL-", "DIR+", "DIR-", "ENA+", "ENA-"]

  DRV_B:
    type: Screw Terminal
    notes: "KL-4030 Driver B (Axis N+8)"
    pins: [1, 2, 3, 4, 5, 6]
    pinlabels: ["PUL+", "PUL-", "DIR+", "DIR-", "ENA+", "ENA-"]

  ESTOP:
    type: NC Pushbutton
    notes: "Emergency Stop"
    pins: [1, 2]
    pinlabels: [COM, NC]
    color: RD

  EXT5V:
    type: Power Supply
    notes: "External 5V (enable circuit)"
    pins: [1, 2]
    pinlabels: ["+5V", GND]

  TIE_0V:
    style: simple
    type: Splice
    notes: "0V tie point"

  TIE_WDOG:
    style: simple
    type: Splice
    notes: "WDOG- tie point"

cables:
  STEPA_PUL:
    wirecount: 1
    notes: "Axis N pulse (SCSI pin 1)"
    colors: [BK]

  STEPA_DIR:
    wirecount: 1
    notes: "Axis N direction (SCSI pin 3)"
    colors: [RD]

  STEPB_PUL:
    wirecount: 1
    notes: "Axis N+8 pulse (SCSI pin 11)"
    colors: ["#90EE90"]

  STEPB_DIR:
    wirecount: 1
    notes: "Axis N+8 direction (SCSI pin 13)"
    colors: [PK]

  # SCSI cable wire from 0V (pin 15) - white/brown
  GND_SCSI:
    wirecount: 1
    notes: "0V SCSI wire (pin 15)"
    colors: [WHBN]

  # Adapter wires from 0V tie point to driver grounds
  GND_A1:
    wirecount: 1
    notes: "Driver A PUL- ground"
    colors: [BK]

  GND_A2:
    wirecount: 1
    notes: "Driver A DIR- ground"
    colors: [BK]

  GND_B1:
    wirecount: 1
    notes: "Driver B PUL- ground"
    colors: [BK]

  GND_B2:
    wirecount: 1
    notes: "Driver B DIR- ground"
    colors: [BK]

  PWR:
    wirecount: 1
    notes: "+5V to E-stop"
    colors: [RD]

  ES:
    wirecount: 1
    notes: "E-stop to WDOG+ (SCSI pin 7)"
    colors: [BU]

  # SCSI cable wire from WDOG- (pin 8) - purple
  WDOG_SCSI:
    wirecount: 1
    notes: "WDOG- SCSI wire (pin 8)"
    colors: [VT]

  # Adapter wires from WDOG tie point to drivers
  WDA:
    wirecount: 1
    notes: "WDOG tie to Driver A ENA+"
    colors: [OG]

  WDB:
    wirecount: 1
    notes: "WDOG tie to Driver B ENA+"
    colors: [OG]

  RA:
    wirecount: 1
    notes: "Driver A ENA- return"
    colors: [BK]

  RB:
    wirecount: 1
    notes: "Driver B ENA- return"
    colors: [BK]

connections:
  # Axis N: MC508 Pulse+/Dir+ → Driver A PUL+/DIR+ (single-ended)
  -
    - MC508_STEP: [1]
    - STEPA_PUL: [1]
    - DRV_A: [1]
  -
    - MC508_STEP: [3]
    - STEPA_DIR: [1]
    - DRV_A: [3]

  # Axis N+8: MC508 Pulse+/Dir+ → Driver B PUL+/DIR+ (single-ended)
  -
    - MC508_STEP: [11]
    - STEPB_PUL: [1]
    - DRV_B: [1]
  -
    - MC508_STEP: [13]
    - STEPB_DIR: [1]
    - DRV_B: [3]

  # MC508 0V (WHT/BRN SCSI wire) → tie point
  -
    - MC508_STEP: [15]
    - GND_SCSI: [1]
    - TIE_0V: [1]

  # 0V tie point → Driver A PUL-/DIR-
  -
    - TIE_0V: [1]
    - GND_A1: [1]
    - DRV_A: [2]
  -
    - TIE_0V: [1]
    - GND_A2: [1]
    - DRV_A: [4]

  # 0V tie point → Driver B PUL-/DIR-
  -
    - TIE_0V: [1]
    - GND_B1: [1]
    - DRV_B: [2]
  -
    - TIE_0V: [1]
    - GND_B2: [1]
    - DRV_B: [4]

  # Enable: 5V → E-stop → WDOG+
  -
    - EXT5V: [1]
    - PWR: [1]
    - ESTOP: [1]
  -
    - ESTOP: [2]
    - ES: [1]
    - MC508_STEP: [7]

  # WDOG- (PUR SCSI wire) → tie point
  -
    - MC508_STEP: [8]
    - WDOG_SCSI: [1]
    - TIE_WDOG: [1]

  # WDOG tie point → Driver A ENA+
  -
    - TIE_WDOG: [1]
    - WDA: [1]
    - DRV_A: [5]

  # WDOG tie point → Driver B ENA+
  -
    - TIE_WDOG: [1]
    - WDB: [1]
    - DRV_B: [5]

  # Driver ENA- returns → 5V GND
  -
    - DRV_A: [6]
    - RA: [1]
    - EXT5V: [2]
  -
    - DRV_B: [6]
    - RB: [1]
    - EXT5V: [2]
